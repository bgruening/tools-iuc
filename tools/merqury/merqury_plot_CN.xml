<tool id="merquryplot" name="Merqury histogram plot" version="@TOOL_VERSION@+galaxy1" profile="20.01">
    <description>evaluate the assembly quality</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="bio_tools"/>
    <expand macro="requirements"/>
    <version_command>merqury --version</version_command>

    <command detect_errors="exit_code"><![CDATA[
        mkdir -p output_files/ &&
        \$MERQURY/plot/plot_spectra_cn.R 
        -f '$input1' 
        -o output_files/merqury_plot
        #if $asm_only
            -z '$asm_only' 
        #end if
        #if $cutoffs
             -l '$cutoffs' 
        #end if 
        -x $xdim
        -y $ydim
        #if $xmax>0
            -m $xmax
        #end if 
        #if $ymax>0
            -n $ymax
        #end if
        -t $type
        #if $output_selector=='pdf'
            -p
        #end if 

    ]]>    </command>
    <inputs>
        <param type="data" name="input1" format="tab" />
        <param name="xdim" type="integer" label="Width of plot"  value="6" min="0" help="(-x)" />
        <param name="ydim" type="integer" label="Height of plot"  value="5" min="0"  help="(-y)" />
        <param name="xmax" type="float" label="Maximum limit for k-mer multiplicity (leave 0 for default)"  value="0" min="0" help="(-m)" />
        <param name="ymax" type="float" label="Maximum limit for k-mer count (leave 0 for default)"  value="0" min="0"  help="(-n)" />
        <param name="asm_only" type="data" label="Assembly only counts" format="tab" help="(-z)" optional="true" />
        <param name="cutoffs" type="data" label="Solid k-mer cutoffs" format="txt" help="(-l)" optional="true" />
        <param name="output_selector" type="select" label="Output format">
            <option value="png" selected="true">PNG</option>
            <option value="pdf">PDF</option>
        </param>
        <param name="type" type="select" label="Type of plot (default all)" help="-t">
            <option value="all" selected="true">All</option>
            <option value="line">Line</option>
            <option value="fill">Fill</option>
            <option value="stack">Stack</option>
        </param>
    </inputs>
    <outputs>
        <collection name="png_files" type="list" label="${tool.name} on ${on_string}: png plots">
            <discover_datasets pattern="(?P&lt;name&gt;.+)\.png" format="png" directory="output_files"/>
            <filter>"png" in output_selector</filter>
        </collection>
        <collection name="pdf_files" type="list" label="${tool.name} on ${on_string}: pdf plots">
            <discover_datasets pattern="(?P&lt;name&gt;.+)\.pdf" format="pdf" directory="output_files"/>
            <filter>"pdf" in output_selector</filter>
        </collection>
    </outputs>
    <tests>
        <test  expect_num_outputs="1">
            <param name="input1" value="output_merqury.assembly_01.spectra-cn.tabular"/>
            <param name="xdim"  value="6" />
            <param name="ydim"  value="5" />
            <param name="xmax"  value="0" />
            <param name="ymax"  value="0" />
            <param name="asm_only" value="output_merqury.assembly_01.only.tabular"/>
            <param name="type" value="all" />
            <param name="output_selector"  value="png" />
            <output_collection name="png_files" type="list" count="3">
                <element name="merqury_plot.fl">
                    <assert_contents>
                        <has_size value="99000" delta="5000"/>
                    </assert_contents>
                </element>
                <element name="merqury_plot.ln">
                    <assert_contents>
                        <has_size value="99000" delta="5000"/>
                    </assert_contents>
                </element>
                <element name="merqury_plot.st">
                    <assert_contents>
                        <has_size value="108000" delta="5000"/>
                    </assert_contents>
                </element>
            </output_collection>
        </test>
    </tests>

   <help><![CDATA[

.. class:: infomark

**Purpose**
Make spectra-cn plots. Line, filled, and stacked spectra-cn plots will be
generated.
 
 --- 

usage: /galaxy/home/delphinel/conda/envs/merqury/share/merqury/plot/plot_spectra_cn.R
       [-h] [-f FILE] [-o OUTPUT] [-z ZERO_HIST] [-l CUTOFF] [-x XDIM]
       [-y YDIM] [-m XMAX] [-n YMAX] [-t TYPE] [-p]


options:
  -h, --help            show this help message and exit
  -f FILE, --file FILE  .spectra-cn.hist file (required)
  -o OUTPUT, --output OUTPUT
                        output prefix (required)
  -z ZERO_HIST, --zero-hist ZERO_HIST
                        .only.hist file (optional, assembly only counts)
  -l CUTOFF, --cutoff CUTOFF
                        cutoff.txt file (optional, solid k-mer cutoffs)
  -x XDIM, --xdim XDIM  width of plot [default 6]
  -y YDIM, --ydim YDIM  height of plot [default 5]
  -m XMAX, --xmax XMAX  maximum limit for k-mer multiplicity [default (x where
                        y=peak) * 2.1]
  -n YMAX, --ymax YMAX  maximum limit for k-mer count [default (y where
                        y=peak) * 1.1]
  -t TYPE, --type TYPE  available types: line, fill, stack, or all. [default
                        all]
  -p, --pdf             get output in .pdf. [default .png]

    ]]>    </help>
    <expand macro="citations"/>
</tool>

