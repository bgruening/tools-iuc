<tool id="lineagespot" name="lineagespot" version="1.2.0">
    <description> Identifies SARS-CoV-2 related mutations based on a single (or a list) of variant(s) file(s).</description>
    <requirements>
        <requirement type="package" version="4.2.0">R</requirement>
        <requirement type="package" version="1.14.6">r-data.table</requirement>
        <requirement type="package" version="1.5.0">r-stringr</requirement>
        <requirement type="package" version="1.4.4">r-httr</requirement>
        <requirement type="package" version="1.4.0">r-RefManageR</requirement>
        <requirement type="package" version="2.20">r-rmarkdown</requirement>
        <requirement type="package" version="1.42">r-knitr</requirement>
        <requirement type="package" version="3.1.6">r-testthat</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        ln -s 'SampleA_freebayes_ann.vcf' ./test-data/extdata/vcf-files/SampleA_freebayes_ann.vcf &&
        ln -s 'SampleB_freebayes_ann.vcf' ./test-data/extdata/vcf-files/SampleB_freebayes_ann.vcf &&
        ln -s 'SampleC_freebayes_ann.vcf' ./test-data/extdata/vcf-files/SampleC_freebayes_ann.vcf &&
        ln -s 'AY.1.txt' ./test-data/extdata/ref/AY.1.txt &&
        ln -s 'AY.2.txt' ./test-data/extdata/ref/AY.2.txt &&
        ln -s 'AY.3.1.txt' ./test-data/extdata/ref/AY.3.1.txt &&
        ln -s 'AY.3.txt' ./test-data/extdata/ref/AY.3.txt &&
        ln -s 'B.1.1.7.txt' ./test-data/extdata/ref/B.1.1.7.txt &&
        ln -s 'B.1.1.7+S_E484K.txt' ./test-data/extdata/ref/B.1.1.7+S_E484K.txt &&
        ln -s 'B.1.351.2.txt' ./test-data/extdata/ref/B.1.351.2.txt &&
        ln -s 'B.1.351.3.txt' ./test-data/extdata/ref/B.1.351.3.txt &&
        ln -s 'B.1.351.txt' ./test-data/extdata/ref/B.1.351.txt &&
        ln -s 'B.1.617.2.txt' ./test-data/extdata/ref/B.1.617.2.txt &&
        ln -s 'P.1.1.txt' ./test-data/extdata/ref/P.1.1.txt &&
        ln -s 'P.1.2.txt' ./test-data/extdata/ref/P.1.2.txt &&
        ln -s 'P.1.txt' ./test-data/extdata/ref/P.1.txt &&
        Rscript '${__tool_directory__}/lineagespot_verbose.R --in_vcf ${__tool_directory__}/test-data/extdata/vcf-files --in_gff3 ${__tool_directory__}/test-data/extdata/NC_045512.2_annot.gff3 --in_ref ${__tool_directory__}/test-data/extdata/ref --in_voc "B.1.617.2, B.1.1.7, B.1.351, P.1" --in_threshold 0.8'
    ]]></command>
    <inputs>
        <param type="data" name="in_vcf" format="vcf" label="vcf file(s)" />
        <param type="data" name="in_gff3" format="gff3" label="gff3 file(s)" />
        <param type="data" name="in_ref" format="txt" label="ref file(s)" />
        <param type="text" name="in_voc" value="1" label="Kmer size to count"/>
        <param type="float" name="in_threshold" value="0.8" label="Kmer size to count"/>
    </inputs>
    <outputs>
        <data name="lineage_hits" format="txt" />
        <data name="lineage_report" format="txt" />
        <data name="variants_table" format="txt" />
    </outputs>
    <tests>
        <test expect_num_outputs="3">
            <param name="in_vcf" value="SampleA_freebayes_ann.vcf,SampleB_freebayes_ann.vcf,SampleC_freebayes_ann.vcf"/>
            <param name="in_gff3" value="NC_045512.2_annot.gff3"/>
            <param name="in_ref" value="AY.1.txt,AY.2.txt,AY.3.1.txt,AY.3.txt,B.1.1.7.txt,B.1.1.7+S_E484K.txt,B.1.351.2.txt,B.1.351.3.txt,B.1.351.txt,B.1.617.2.txt,P.1.1.txt,P.1.2.txt,P.1.txt"/>
            <param name="in_voc" value="B.1.617.2, B.1.1.7, B.1.351, P.1"/>
            <param name="in_threshold" value="0.8"/>
            <output name="lineage_hits">
                <assert_contents>
                    <has_n_lines n="40"/>
                </assert_contents>
            </output>
            <output name="lineage_report">
                <assert_contents>
                    <has_n_lines n="731"/>
                </assert_contents>
            </output>
            <output name="variants_table">
                <assert_contents>
                    <has_n_lines n="1829"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        Reads VCF files and recognises SARS-CoV-2 related mutations.
    ]]></help>
    <citations>
        <citation type="bibtex">@article{Pechlivanis2022ER,
        author={Pechlivanis, Nikolaos and Tsagiopoulou, Maria and Maniou, Maria Christina and Togkousidis, Anastasis and Mouchtaropoulou, Evangelia and Chassalevris, Taxiarchisand Chaintoutis, Serafeim C. and Petala, Maria and Kostoglou, Margaritis and Karapantsios, Thodoris and Laidou, Stamatia and Vlachonikola, Elisavet and Chatzidimitriou, Anastasia and Papadopoulos, Agis and Papaioannou, Nikolaos and Dovas, Chrysostomos I. and Argiriou, Anagnostis and Psomopoulos, Fotis},
        title={Detecting SARS-CoV-2 lineages and mutational load in municipal wastewater and a use-case in the metropolitan area of Thessaloniki, Greece},
        journal={Scientific Reports},
        year={2022},
        month={Feb},
        day={17},
        volume={12},
        number={1},
        pages={2659},
        abstract={The COVID-19 pandemic represents an unprecedented global crisis necessitating novel approaches for, amongst others, early detection of emerging variants relating to the evolution and spread of the virus. Recently, the detection of SARS-CoV-2 RNA in wastewater has emerged as a useful tool to monitor the prevalence of the virus in the community. Here, we propose a novel methodology, called lineagespot, for the monitoring of mutations and the detection of SARS-CoV-2 lineages in wastewater samples using next-generation sequencing (NGS). Our proposed method was tested and evaluated using NGS data produced by the sequencing of 14 wastewater samples from the municipality of Thessaloniki, Greece, covering a 6-month period. The results showed the presence of SARS-CoV-2 variants in wastewater data. lineagespot was able to record the evolution and rapid domination of the Alpha variant (B.1.1.7) in the community, and allowed the correlation between the mutations evident through our approach and the mutations observed in patients from the same area and time periods. lineagespot is an open-source tool, implemented in R, and is freely available on GitHub and registered on bio.tools.},
        issn={2045-2322},
        doi = "10.1038/s41598-022-06625-6",
        url={https://doi.org/10.1038/s41598-022-06625-6}
        }</citation>
 </citations> 
 
</tool>