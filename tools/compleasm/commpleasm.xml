
<tool id="compleasm_run" name="compleasm" version="@TOOL_VERSION@+galaxy0" profile="20.01">
    <description>run</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">compleasm</requirement>
    </requirements>
    <command><![CDATA[
    compleasm run
    -a '$input'
    -o galaxy
    
    #if $mode =="busco"
        --mode busco
    #elif $mode =="lite"
        --mode lite
    #end if

    -l '$lineage'

    #if str($specified_contigs) != '':
        --specified_contigs '$specified_contigs'
    #end if

    ]]></command>
    <inputs>
        <param argument="-a" name="input" type="data" format="fasta" label="Input genome file"/>
        <param name="mode" type="select" label="The mode of evaluation" help="If you want to use hmmsearch, select BUSCO mode. Otherwise select lite mode">
            <option value="busco" selected="true">BUSCO</option>
            <option value="lite">Lite</option>
        </param>
        <param argument="--specified_contigs" type="text" label="Specify the contigs to be evaluated (e.g. chr1 chr2 chr3)" optional="true" help="If not specified, all contigs will be evaluated"/>
        
        <param name="lineage" label="Choose the BUSCO lineage to be used" type="select" multiple="false">
            <options from_data_table="compleasm"/>
        </param>
    
        <param name="outputs" type="select" multiple="true" label="Which outputs should be generated">
            <option value="summary" selected="true">summary text</option>
            <option value="full_table_busco">full table busco</option>
            <option value="full_table">full table</option>
            <option value="miniprot">miniprot</option>
            <option value="gene_marker">gene marker</option>
            <option value="translated_protein">translated proteins</option>
        </param>
    </inputs>

    <outputs>
        <data name='sum' format='txt' label="${tool.name} on ${on_string}: summary" from_work_dir="galaxy/eukaryota*/summary.txt">
            <filter>outputs and 'summary' in outputs</filter>
        </data>

        <data name='full_table_busco' format='tsv' label="${tool.name} on ${on_string}: full table BUSCO" from_work_dir="galaxy/eukaryota*/full_table_busco_format.tsv">
            <filter>outputs and 'full_table_busco' in outputs</filter>
        </data>
        <data name='full_table' format='tsv' label="${tool.name} on ${on_string}: full table" from_work_dir="galaxy/eukaryota*/full_table.tsv">
            <filter>outputs and 'full_table' in outputs</filter>
        </data>
        <data name='miniprot' format='gff3' label="${tool.name} on ${on_string}: Miniprot" from_work_dir="galaxy/eukaryota*/miniprot_output.gff">
            <filter>outputs and 'miniprot' in outputs</filter>
        </data>
        <data name='gene_marker' format='fasta' label="${tool.name} on ${on_string}: Gene marker" from_work_dir="galaxy/eukaryota*/gene_marker.fasta">
            <filter>outputs and 'gene_marker' in outputs</filter>
        </data>
        <data name='translated_protein' format='fasta' label="${tool.name} on ${on_string}: Translated protein" from_work_dir="galaxy/eukaryota*/translated_protein.fasta">
            <filter>outputs and 'translated_protein' in outputs</filter>
        </data>              
    </outputs>
    
    <tests>
        <test expect_failure="true">
            <param name="input" value="input.fasta"/>
            <param name="outputs" value="sum,detail_sum,png,hog,pdf,ump,tax"/>
            <param name="lineage" value="eukaryota"/>
        </test>
    </tests>

    <help><![CDATA[

    compleasm_ The run module assesses genome completeness based on genome assembly. 

    .. _compleasm: https://github.com/huangnengCSU/compleasm

    ]]>    
    </help>
    <expand macro="citation"></expand>
</tool>