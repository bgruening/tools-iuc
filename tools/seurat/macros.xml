<macros>
    <token name="@TOOL_VERSION@">4.1.1</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">r-seurat</requirement>
            <requirement type="package" version="2.14">r-rmarkdown</requirement>
        </requirements>
    </xml>
    <xml name="start">
        <param name="input" type="data" format="tabular,tsv" label="Counts file" help="The should be a TAB-separated count matrix with gene identifers in the first column and a header row"/>
        <param name="min_cells" type="integer" min="0" value="0" label="Minimum cells" help="Include genes with detected expression in at least this many cells" />
        <param name="min_genes" type="integer" min="0"  value="0" label="Minimum genes" help="Include cells where at least this many genes are detected"/>
        <expand macro="norm"/>
    </xml>
    <xml name="norm">
        <param name="low_thresholds" type="integer" value="1" label="Low threshold for filtering cells" />
        <param name="high_thresholds" type="integer" value="20000000" label="High threshold for filtering cells" />
        <param name="norm_file" type="boolean" truevalue="T" falsevalue="F" label="Output data after this step"/>
        <conditional name="variable_continue">
            <param name="variable_continue" type="select" label="Continue workflow after Normalization step?">
                <option value="yes">Yes</option>
                <option value="no" selected="true">No</option>
            </param>
            <when value="yes">
                <expand macro="variable"/>
            </when>
            <when value="no"/>
        </conditional>
    </xml>
    <xml name="variable">
        <param name="var_file" type="boolean" truevalue="T" falsevalue="F" label="Output data after scaling step"/>
        <conditional name="pca_continue">
            <param name="pca_continue" type="select" label="Continue workflow after scaling step?">
                <option value="yes">Yes</option>
                <option value="no" selected="true">No</option>
            </param>
            <when value="yes">
                <expand macro="pca"/>
            </when>
            <when value="no"/>
        </conditional>
    </xml>
    <xml name="pca">
        <param name="num_PCs" type="integer" min="0" value="10" label="Number of PCs to use in plots" help="Uses this number of PCs in PCHEatmap, JackStrawPlot, FindClusters, RunTSNE" />
        <param name="pca_file" type="boolean" truevalue="T" falsevalue="F" label="Output tabular data after this step"/>
        <conditional name="clusters_continue">
            <param name="clusters_continue" type="select" label="Continue workflow after PCA step?">
                <option value="yes">Yes</option>
                <option value="no" selected="true">No</option>
            </param>
            <when value="yes">
                <expand macro="clusters"/>
            </when>
            <when value="no"/>
        </conditional>
    </xml>
    <xml name="clusters" label="TSNE and Clustering" expanded="true">
        <param name="perplexity" type="integer" value="" optional="true" label="Perplexity parameter" help="Parameter for the tSNE dimensionality reduction" />
        <param name="resolution" type="float" value="0.6" label="Resolution parameter" help="Value of the resolution parameter used in FindClusters, use a value above (below) 1.0 if you want to obtain a larger (smaller) number of communities" />
        <param name="tsne_file" type="boolean" truevalue="T" falsevalue="F" label="Output TSNE and UMAP data files"/>
        <conditional name="markers_continue">
            <param name="markers_continue" type="select" label="Continue workflow after this step?">
                <option value="yes">Yes</option>
                <option value="no" selected="true">No</option>
            </param>
            <when value="yes">
                <expand macro="markers"/>
            </when>
            <when value="no"/>
        </conditional>
    </xml>
    <xml name="markers">
        <param name="logfc_threshold" type="float" min="0" value="0.25" label="Log fold change threshold"
            help="With FindMarkers, limit testing to genes which show, on average, at least X-fold difference (log-scale) between the two groups of cells. Increasing this parameter speeds up the function, but can miss weaker signals" />
        <param name="markers_file" type="boolean" truevalue="T" falsevalue="F" label="Output tabular data after this step"/>
    </xml>
</macros> 