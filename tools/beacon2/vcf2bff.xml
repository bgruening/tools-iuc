<tool id="vcf2bff" name="Vcf2bff" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="21.05">
    <description>A script for parsing annotated vcf files and transforming the data to the format needed for Beacon v2</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="xrefs"/>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[   
        ln -s '$input' ./sample.vcf &&
        vcf2bff.pl
            --input ./sample.vcf
            --format '$format'
            --project-dir ./
            --dataset-id '$dataset_id'
            --genome '$genome'
    ]]></command>
    <inputs>
        <param argument="--input" type="data" format="tabular.gz" label="Annotated vcf file" help="" />
        <param argument="--format" type="select" label="Output format" help="">
            <option value="bff" selected="True">bff</option>
            <option value="hash">hash</option>
            <option value="json">json</option>
        </param>
        <param argument="--dataset-id" type="text" label="Dataset ID" value="" help="" />
        <param argument="--genome" type="text" label="Reference genome" value="" help="" />
    </inputs>
    <outputs>
        <data name="genomicVariationsVcf" format="json" label="${tool.name} on ${on_string}: genomicVariationsVcf file" from_work_dir="vcf2bff/genomicVariationsVcf.json.gz" />
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input" ftype="tabular.gz" value="vcf2bff/test_1000G.norm.ann.dbnsfp.clinvar.cosmic.vcf.gz" />
            <param name="format" value="bff"/>
            <param name="dataset_id" value="beacon"/>
            <param name="genome" value="hs37"/>
            <output name="genomicVariationsVcf" file="vcf2bff/genomicVariationsVcf.json.gz" compare="sim_size">
                <assert_contents><has_size value="560000" delta="100000" /></assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
          Script to parse a VCF having SnepEff/SnpSift annotations
      
          The output can be:
      
                 a) genomicVariantsVcf.json.gz [bff]
                 b) Standard JSON [json]
                 c) Perl hash data structure [hash]
      
      HOW TO RUN VCF2BFF
          For executing vcf2bff you will need:
      
          1 - Input file
              VCF file.
      
          2 - Dataset ID
              String.
      
          3 - Reference genome
              String.
      
          Examples:
      
          ./vcf2bff.pl -i file.vcf.gz --dataset-id my_id_1 --genome hg19
      
          ./vcf2bff.pl -i file.vcf.gz --id my_id_1 -g hg19 -verbose log 2>&1
      
          nohup $path/vcf2bf.pl -i file.vcf.gz -debug 5 --dataset-id my_id_1 --genome hg19
    ]]></help>
    <expand macro="citations" />
</tool>
