<tool id="abritamr" name="abritAMR" version="@WRAPPER_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>AMR gene detection with AMRFinderPlus</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[

#if str($input_type_cond.input_type) in ['single']:
    #set read1 = $input_type_cond.read1
    touch input.tsv &&
    echo $read1.element_identifier "\t" $read1 &&
    #set args = "--prefix " + $read.element.identifier
## #else:
##     #set read1 = $input_type_cond.reads_collection['forward']
##     #set read1_identifier = re.sub('[^\s\w\-]', '_', str($read1.element_identifier))
##     ## Tadpole uses the file extension to determine the input format.
##     #set ext = $read1_identifier + '.fastq'
##     #if $read1.ext.endswith('.gz'):
##         #set ext = $ext + '.gz'
##     #end if
##     #set read1_file = $read1_identifier + $ext
##     ln -s '${read1}' '${read1_file}' &&
##     #set read2 = $input_type_cond.reads_collection['reverse']
##     #set read2_identifier = re.sub('[^\s\w\-]', '_', str($read2.element_identifier))
##     #set read2_file = $read2_identifier + $ext
##     ln -s '${read2}' '${read2_file}' &&
#end if

abritamr run \
    --contigs input.tsv \
    --jobs \${GALAXY_SLOTS:-4} \
    --species='$output_options.species \
#if str($output_options.identity):
    --identity='$output_options.identity' \
#end if
    $args
]]></command>
    <inputs>
        <expand macro="input_type_cond"/>
        <section name="output_options" title="Output options">
            <param argument="species" type="select" multiple="true" label="Specify species to aquire sresistance mechanisms as point mutations">
                <option value="neisseria">Neisseria</option>
                <option value="clostridioides_difficile">Clostridioides difficile</option>
                <option value="acinetobacter_baumannii">Acinetobacter baumannii</option>
                <option value="campylobacter">Campylobacter</option>
                <option value="enterococcus_faecalis">Enterococcus faecalis</option>
                <option value="enterococcus_faecium">Enterococcus faecium</option>
                <option value="escherichia">Escherichia</option>
                <option value="klebsiella">Klebsiella</option>
                <option value="salmonella">Salmonella</option>
                <option value="staphylococcus_aureus">Staphylococcus aureus</option>
                <option value="staphylococcus_pseudintermedius">Staphylococcus pseudintermedius</option>
                <option value="streptococcus_agalactiae">Streptococcus agalactiae</option>
                <option value="streptococcus_pneumoniae">Streptococcus pneumoniae</option>
                <option value="streptococcus_pyogenes">Streptococcus pyogenes</option>
            </param>
            <param argument="identity" type="float" optional="true" label="Minimum identity of matches with armfinder. Default: 0.9, unless curated threshold is present."/>
        </section>
    </inputs>
    <outputs>
        <data name="summary_matches" format="txt" label="${tool.name}" />
        <!-- <data name="output" format="fastqsanger" label="${tool.name} on ${on_string} (Forward)"/> -->
        <!-- <data name="output2" format="fastqsanger" label="${tool.name} on ${on_string} (Reverse)"> -->
        <!--     <filter>input_type_cond['input_type'] != 'single' and mode_options['mode'] != 'contig'</filter> -->
        <!-- </data> -->
        <!-- <data name="outputdump" format="fasta" label="${tool.name} on ${on_string} (Fastadump}"> -->
        <!--     <filter>output_options['fastadump']</filter> -->
        <!-- </data> -->
    </outputs>
    <tests>
        <!-- Single sample -->
        <!-- Multi sample -->
    </tests>
    <help>
*Taming the AMR beast*

abriTAMR is an AMR gene detection pipeline that runs AMRFinderPlus on a single (or list ) of given isolates and collates the results into a table, separating genes identified into functionally relevant groups. abriTAMR is accredited by NATA for use in reporting the presence of reportable AMR genes in Victoria Australia.
    + Acquired resistance mechanims in the form of point mutations (restricted to subset of species)
    + Streamlined output.
    + Presence of virulence factors
    </help>
    <expand macro="citations"/>
</tool>
