<macros>
    <token name="@VERSION_SUFFIX@">0</token>
    <token name="@TOOL_VERSION@">0.9.10</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">cnvkit</requirement>
        </requirements>
    </xml>
    <xml name="reference_interface">
        <conditional name="reference_source">
            <param name="ref_selector" optional="true" type="select" label="Choose the source for the reference genome">
                <option value="cached">Locally cached</option>
                <option value="history">History</option>
            </param>
            <when value="cached">
                <param argument="--fasta" optional="true" type="select" label="Reference genome">
                    <options from_data_table="fasta_indexes">
                        <!-- <filter type="data_meta" column="dbkey" key="dbkey" ref="input_sample_file" /> -->
                        <validator type="no_options" message="A built-in reference genome is not available for the build associated with the selected input file" />
                    </options>
                </param>
            </when>
            <when value="history">
                <param argument="--fasta" type="data" optional="true" format="fasta" label="Reference" help="Reference sequence" />
            </when>
        </conditional>
    </xml>
    <xml name="xrefs">
        <xrefs>
            <xref type="bio.tools">cnvkit</xref>
        </xrefs>
    </xml>
    <xml name="shared">
    <!-- general parameters -->
            <param name="method" type="select" label="Select the sequencing method of the input file(s) " help="">
                <option value="hybrid" selected="True">hybridization capture </option>
                <option value="amplicon">targeted amplicon sequencing </option>
                <option value="wgs"> whole genome sequencing </option>
            </param>
            <param name="segment_method" type="select" label="Method used in the 'segment' step" help="">
                <option value="cbs" selected="True">Circular Binary Segmentation (CBS) method,hybrid (CBS)</option>
                <option value="flasso">Fused lasso, hybrid (flasso)</option>
                <option value="haar"> a pure-Python implementation of HaarSeg, a wavelet-based method. Very fast and performs reasonably well on small panels, but tends to over-segment large datasets., hybrid (haar)</option>
                <option value="none">simply calculate the weighted mean log2 value of each chromosome arm. Useful for testing or debugging, or as a baseline for benchmarking other methods., hybrid (none)</option>
                <option value="hmm">(experimental) – a 3-state Hidden Markov Model suitable for most samples. Faster than CBS, and slower but more accurate than Haar. Requires the Python package pomegranate, as do the next two methods., hybrid (hmm)</option>
                <option value="hmm-tumor"> (experimental) – a 5-state HMM suitable for finer-grained segmentation of good-quality tumor samples. In particular, this method can detect focal amplifications within a larger-scale, smaller-amplitude copy number gain, or focal deep deletions within a larger-scale hemizygous loss. Training this model takes a bit more CPU time than the simpler hmm method., hybrid (hmm-tumor)</option>
                <option value="hmm-germline">(experimental) – a 3-state HMM with fixed amplitude for the loss, neutral, and gain states corresponding to absolute copy numbers of 1, 2, and 3. Suitable for germline samples and single-cell sequencing of samples with mostly-diploid genomes that are not overly aneuploid., hybrid (hmm-germline)</option>
            </param>
            <param name="male_reference" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Use or assume a male reference" help="female samples will have +1 log-CNR of chrX; otherwise male samples would have -1 chrX)" />
            <param name="countreads" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Get read depths by counting read midpoints within each bin" help="" />
            <param name="drop_low_coverage" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Drop very-low-coverage bins before segmentation" help="To avoid false-positive deletions in poor-quality tumor samples" />
    </xml>
    <xml name="create_CNV_reference_file">
        <param name="input_sample_file" type="data" format="bam" label="Sample BAM file" help="Sample file in .BAM format." />
        <param name="normal" type="data" format="bam" label="Control BAM file" help="Control file in .BAM format." />
        <param name="targets" type="data" format="bed" label="Capture BED regions" help="Capture regions in .BED format." />
        
    </xml>
    <xml name="advanced_no_reference">
        <param name="antitargets" optional="true" type="data" format="bed" label="Antitarget intervals" help="(.bed or .list)" />
        <param name="annotate" optional="true" type="data" format="bed" label="Use gene models from this file to assign names to the target regions" help="Format: UCSC refFlat.txt or ensFlat.txt file (preferred), or BED, interval list, GFF, or similar." />
        <param name="short_names" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Reduce multi-accession bait labels" help="" />
        <param name="target_avg_size" type="integer" optional="true" label="Average size of split target bins" value="0" help="Only integers, don't use fractures" />
        <param name="access" optional="true" type="data" format="bed" label="Regions of accessible sequence on chromosomes (.bed)" help="" />
        <param name="antitarget_avg_size" optional="true" type="integer" label="Average size of antitarget bins" value="0" help="" />
        <param name="antitarget_min_size" optional="true" type="integer" label="Minimum size of antitarget bins" value="0" help="" />
        <param name="cluster" optional="true" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Calculate and use cluster-specific summary stats in the reference pool" help="" />
    </xml>
    <xml name="reuse_an_existing_cnv_reference_file">
        <param name="input_sample_file" type="data" format="bam" label="Sample file" help="Sample BAM ile" />
        <param name="reference" type="data" format="tabular" label="CNV reference CNN File" help="Reference file in .CNN format." />
    </xml>
    <xml name="output_section">
        <section name="output_section" title="Outputs" expanded="false">
            <param name="scatter" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Create a whole-genome copy ratio profile as a PNG scatter plot." help="" />
            <param name="diagram" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Create an ideogram of copy ratios on chromosomes as a PDF." help="" />
        </section>
    </xml>
    <xml name="autobin_optional">
            <param name="method" type="select" label="Select the sequencing method of the input file(s) " help="">
                <option value="hybrid" selected="True">hybridization capture </option>
                <option value="amplicon">targeted amplicon sequencing </option>
                <option value="wgs"> whole genome sequencing </option>
            </param>
            <param name="access" optional="true" type="data" format="bed" multiple="false" label="Sequencing-accessible genomic regions, or exons to use as possible targets" help="(e.g. output of refFlat2bed.py)" />
            <param name="bp_per_bin" type="integer" label=" Desired average number of sequencing read bases mapped to each bin." value="100000" help="only use integers, don't use fractures" />
            <param name="target_max_size" type="integer" label="Maximum size of target bins." value="20000" help="only use integers, don't use fractures" />
            <param name="target_min_size" type="integer" label="Minimum size of target bins." value="20" help="only use integers, don't use fractures" />
            <param name="antitarget_max_size" type="integer" label="Maximum size of antitarget bins." value="500000" help="only use integers, don't use fractures" />
            <param name="antitarget_min_size" type="integer" label="Minimum size of antitarget bins." value="500" help="only use integers, don't use fractures" />
            <param name="annotate" optional="true" type="data" format="bed" multiple="false" label="Use gene models from this file to assign names to the target regions." help="Format: UCSC refFlat.txt or ensFlat.txt file (preferred), or BED, interval list, GFF, or similar." />
            <param name="short_names" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Reduce multi-accession bait labels to be short and consistent" help="" />
            <param name="target_output_bed" optional="true" type="data" format="bed" multiple="false" label="Filename for target BED output." help="If not specified, constructed from the input file basename." />
            <param name="antitarget_output_bed" optional="true" type="data" format="bed" multiple="false" label="Filename for antitarget BED output." help="If not specified, constructed from the input file basename." />
    </xml>
    <xml name="call_optional">
            <param name="method" type="select" label="Select the sequencing method of the input file(s) " help="">
                <option value="threshold" selected="True">hybridization capture </option>
                <option value="clonal">targeted amplicon sequencing </option>
                <option value="none"> whole genome sequencing </option>
            </param>
            <param name="center" type="select" label="Method used in the 'segment' step" help="">
                <option value="mean"></option>
                <option value="median" selected="True"></option>
                <option value="mode"></option>
                <option value="biweight"></option>
            </param>
            <param name="center_at" optional="true" type="float" label="Subtract a constant number from all log2 ratios." value="0" help="For manual re-centering, in case the --center option gives unsatisfactory results.)" />
            <param name="filter" type="select" multiple="true" label="Method used in the 'segment' step" help="">
                <option value="ampdel"></option>
                <option value="cn" selected="True"></option>
                <option value="ci"></option>
                <option value="sem"></option>
            </param>
            <param name="thresholds" optional="true" type="text" label="Hard thresholds for calling each integer copy number, separated by commas." value="=-1.1,-0.25,0.2,0.7" help=" Use the '=' sign on the command line, e.g.: -t=-1,0,1" />
            <param name="ploidy" optional="true" type="integer" label="Ploidy of the sample cells." value="2" help="" />
            <param name="purity" optional="true" type="integer" label="Estimated tumor cell fraction, a.k.a. purity or cellularity." value="0" help="" />
            <param name="drop_low_coverage" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Drop very-low-coverage bins before segmentation" help="To avoid false-positive deletions in poor-quality tumor samples" />
            <param name="sample_sex" type="select" label="Method used in the 'segment' step" help=""> 
                <option value="Male"></option>
                <option value="Female"></option>
            </param>
            <param name="male_reference" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Use or assume a male reference" help="Was a male reference used? If so, expect half ploidy on chrX and chrY; otherwise, only chrY has half ploidy. In CNVkit, if a male reference was used, the neutral copy number (ploidy) of chrX is 1; chrY is haploid for either reference sex." />            
    </xml>
    <xml name="additionally_SNP_process">
        <param name="vcf" optional="true" type="data" format="vcf" label="VCF file" help="VCF file name containing variants for calculation of b-allele frequencies." />
        <param name="sample_id" optional="true" type="text" label="Name of the sample in the VCF to use for b-allele frequency extraction." value="" help="" />
        <param name="normal_id" optional="true" type="text" label="Corresponding normal sample ID in the input VCF" value="" help="This sample is used to select only germline SNVs to calculate b-allele frequencies." />
        <param name="min_variant_depth" optional="true" type="integer" label="Minimum read depth for a SNV to be used in the b-allele frequency calculation." value="20" help="" />
        <param name="zygosity-freq" optional="true" type="float" label="Ignore VCF's genotypes" value="0.25" help="Ignore VCF's genotypes and instead infer zygosity from allele frequencies." />  
    </xml>
    <xml name="diagram_optional">
            <param name="segment" optional="true" type="data" format="cns" multiple="false" label="Segment" help="Segmentation calls (.cns), the output of the 'segment' command." />
            <param name="threshold" optional="true" type="float" label="Threshold" value="0.5" help="Copy number change threshold to label genes." />
            <param name="min_probes" optional="true" type="integer" label="Minimum propes" value="3" help="Minimum number of covered probes to label a gene." />
            <param name="male_reference" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="MALE REFERENCE" help="Assume inputs were normalized to a male reference" />
            <param name="sample_sex" type="select" label="Specify the sample's chromosomal sex" help="">
                <option value="Male">Male sample's chromosomal sex</option>
                <option value="Female">Female sample's chromosomal sex</option>
            </param>
            <param name="no_shift_xy" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Don't adjust the X and Y chromosomes according to sample sex." help="" />
            <param name="chromosome" optional="true" type="text" label="CHROMOSOME" value="" help="Chromosome to display, e.g. 'chr1' (no chromosomal range allowed)" />
    </xml>
    <xml name="diagram_plot">
        <param name="title" optional="true" type="text" label="Plot title" value="" help="" />
        <param name="no_gene_labels" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Disable gene_name labels on plot (useful when a lot of CNV were called)" help="" />
    </xml>
    <xml name="heatmap_optional">
            <param name="by_bin" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Plot data x-coordinates by bin indices instead of genomic coordinates" help="" />
            <param name="chromosome" optional="true" type="text" label="Chromosome range" value="" help="Chromosome or chromosomal range, e.g. 'chr1' or 'chr1:2333000-2444000'" />
            <param name="desaturate" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Tweak color saturation to focus on significant changes" help="" />
            <param name="male_reference" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="MALE REFERENCE" help="Assume inputs were normalized to a male reference" />
            <param name="sample_sex" type="select" label="Specify the sample's chromosomal sex as male or female." help="">
                <option value="Male"></option>
                <option value="Female"></option>
            </param>
            <param name="no_shift_xy" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Don't adjust the X and Y chromosomes according to sample sex." help="" />
            <param name="vertical" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Plot heatmap with samples as X-axis (instead of Y-axis)" help="" />
            <param name="delimit_samples" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Add an horizontal delimitation line between each sample" help="" />
            <param name="title" optional="true" type="text" label="Plot title" value="" help="" />
    </xml>
    <xml name="reference_optional">
            <param name="cluster" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Calculate and store summary stats for clustered subsets of the normal samples with similar coverage profiles" help="" />
            <param name="min_cluster_size" optional="true" type="integer" label="Minimum cluster size to keep in reference profiles." value="4" help="" />
            <param name="sample_sex" type="select" label="Method used in the 'segment' step" help="">
                <option value="Male"></option>
                <option value="Female"></option>
            </param>
            <param name="male_reference" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Create a male reference" help="shift female samples' chrX log-coverage by -1, so the reference chrX average is -1. Otherwise, shift male samples' chrX by +1, so the reference chrX average is 0" />         
    </xml>
    <xml name="construct_CNV_ref_with_natural_expected_number">
        <param name="targets" optional="true" type="data" format="bed" label="Target intervals bed file" help="" />
        <param name="antitargets" optional="true" type="data" format="bed" label="Antitarget intervals bed file" help="" />
    </xml>
    <xml name="disable_specific_automatic_bias_corrections">
        <param name="no_gc" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Skip GC correction" help="" />
        <param name="no_edge" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="skip edge-effect correction" help="" />
        <param name="no_rmask" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="skip repeat master correction" help="" /> 
    </xml>
    <xml name="scatter_optional">
            <param name="segment" optional="true" type="data" format="cns" multiple="false" label="Segment" help="Segmentation calls (.cns), the output of the 'segment' command." />
            <param name="chromosome" optional="true" type="text" label="Chromosome range" value="" help="Chromosome or chromosomal range, e.g. 'chr1' or 'chr1:2333000-2444000'" />
            <param name="gene" optional="true" type="text" label="Name of gene or genes (comma-separated) to display" value="" help="" />
            <param name="range_list" optional="true" type="data" format="bed" multiple="false" label="Range list" help=" File listing the chromosomal ranges to display, as BED" />
            <param name="width" optional="true" type="integer" label="Width" value="1000000" help="Width of margin to show around the selected gene(s) or small chromosomal region" />  
    </xml>
    <xml name="scatter_plot">
        <param name="antitarget_marker" optional="true" type="text" label="Antitarget marker" value="same as targets" help="Plot antitargets using this symbol when plotting in a selected chromosomal region" />
        <param name="by_bin" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Plot data x-coordinates by bin indices instead of genomic coordinates" help="" />
        <param name="segment_color" optional="true" type="text" label="Segment color" value="" help="" />
        <param name="title" optional="true" type="text" label="Plot title" value="" help="" />
        <param name="trend" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Draw a smoothed local trendline on the scatter plot." help="" />
        <param name="y_max" optional="true" type="integer" label="y-axis upper limit" value="0" help="" />
        <param name="y_min" optional="true" type="integer" label="y-axis lower limit" value="0" help="" />
        <param name="fig_size" optional="true" type="float" label="Width and height of the plot in inches" value="0" help="Example 6.4 4.8, the space between the two inputs is important" />
    </xml>
    <xml name="segment_optional">
            <param name="dataframe" type="text" optional="true" label="Data frame" value="" help="File name to save the raw R dataframe emitted by CBS or Fused Lasso, example dataframe.r" />
            <param name="method" type="select" label="Segmentation method" help="">
                <option value="cbs" selected="True">Circular Binary Segmentation (CBS) method,hybrid (CBS)</option>
                <option value="flasso">Fused lasso, hybrid (flasso)</option>
                <option value="haar"> a pure-Python implementation of HaarSeg, a wavelet-based method. Very fast and performs reasonably well on small panels, but tends to over-segment large datasets., hybrid (haar)</option>
                <option value="none">simply calculate the weighted mean log2 value of each chromosome arm. Useful for testing or debugging, or as a baseline for benchmarking other methods., hybrid (none)</option>
                <option value="hmm">(experimental) – a 3-state Hidden Markov Model suitable for most samples. Faster than CBS, and slower but more accurate than Haar. Requires the Python package pomegranate, as do the next two methods., hybrid (hmm)</option>
                <option value="hmm-tumor"> (experimental) – a 5-state HMM suitable for finer-grained segmentation of good-quality tumor samples. In particular, this method can detect focal amplifications within a larger-scale, smaller-amplitude copy number gain, or focal deep deletions within a larger-scale hemizygous loss. Training this model takes a bit more CPU time than the simpler hmm method., hybrid (hmm-tumor)</option>
                <option value="hmm-germline">(experimental) – a 3-state HMM with fixed amplitude for the loss, neutral, and gain states corresponding to absolute copy numbers of 1, 2, and 3. Suitable for germline samples and single-cell sequencing of samples with mostly-diploid genomes that are not overly aneuploid., hybrid (hmm-germline)</option>
            </param>
            <param name="threshold" optional="true" type="integer" label="Significance threshold" help="To accept breakpoints during segmentation. For HMM methods, this is the smoothing window size." />
            <param name="drop_low_coverage" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Drop very-low-coverage bins before segmentation" help="To avoid false-positive deletions in poor-quality tumor samples" />
            <param name="drop_outliers" optional="true" type="integer" label=" Drop outlier" value="10" help="Drop outlier bins more than this many multiples of the 95th quantile away from the average within a rolling window. Set to 0 for no outlier filtering." />
            <param name="smooth_cbs" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Perform an additional smoothing before CBS segmentations" help="" />        
    </xml>
</macros>