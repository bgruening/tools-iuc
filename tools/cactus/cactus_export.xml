<tool id="cactus_export" name="Cactus: export" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@" license="MIT">
    <description>whole-genome multiple sequence alignment to other formats.</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="xrefs"/>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        ln -s '$hal_file' alignment.hal 

        &&
        
        hal2maf alignment.hal
        #if str($ref_level):
            --refGenome '$ref_level'
        #end if
        alignment.maf

        ## what are these for? 
        ## hal2fasta HALFILE $(halStats --root HALFILE) --subtree --upper > gfatemp.fa
        ## hal2paf HALFILE --hdf5InMemory --onlySequenceNames > gfatemp.paf
        ## seqwish -p gfatemp.paf -s gfatemp.fa -g out.gfa

        ## if assemblyhub output
        ## hal2assemblyHub.py WORKDIR HALFILE OUTDIR

        ## if pangenome (.pg) output
        ## hal2vg input.hal --hdf5InMemory --chop 32 --progress > output.pg

    ]]></command>
    <inputs>
        <param name="hal_file" type="data" format="h5" label="HAL file" help="Multiple-genome alignment generated by Cactus" />
        <param name="output_selector" type="select" multiple="True" display="checkboxes" label="Select outputs">
            <option value="maf">Multiple Alignment Format (MAF)</option>
            <option value="vg">vg-compatible sequence graph</option>
            <!-- <option value="gfa">NOT IMPLEMENTED (requires seqwish)</option> -->
        </param>
        <conditional name="enable_maf"> 
            <param name="maf_selector" type="boolean" checked="false" label="Generate a MAF file" />
            <when value="true">
                <param name="ref_level" type="text" optional="True" value="" label="Optional: reference genome for MAF" help="Specify one of the Input Genomes as the reference level for the Multiple Alignment Format (MAF) file. This must match the label used in 'Genome Label'. If nothing is specified, the first Input Genome will be the reference genome in the MAF file. This option doesn't affect the HAL output." />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="maf" format="maf" from_work_dir="alignment.maf" label="${tool.name} on ${on_string} (MAF file)" >
            <filter>output_selector and 'info_file' in output_selector</filter>
        </data>
        <data name="vg" format="vg" from_work_dir="alignment.maf" label="${tool.name} on ${on_string} (VG file)" >
            <filter>output_selector and 'info_file' in output_selector</filter>
        </data>
        <!-- <data name="gfa" format="gfa1" from_work_dir="alignment.maf" label="${tool.name} on ${on_string} (GFA file)" >
            <filter>output_selector and 'info_file' in output_selector</filter>
        </data> -->
    </outputs>
    <tests>
        <!-- within-species mode -->
        <test expect_num_outputs="1">
            <param name="hal_file" ftype="h5" value="within.hal" />
            <output name="out_maf" file="hal2maf.maf" />
        </test>
        <!-- set reference level -->
        <test expect_num_outputs="1">
            <param name="hal_file" ftype="h5" value="within.hal" />
            <param name="ref_level" value="simMouse_chr6" />
            <output name="out_maf" file="set_reference.maf" />
        </test>
        <!-- write a test for reference level in the evolverMammals.hal -->
        <test expect_num_outputs="1">
            <param name="hal_file" ftype="h5" value="evolverMammals_noroot.hal" />
            <param name="ref_level" value="simMouse_chr6" />
            <output name="out_maf" file="evolverMammals_noroot.maf" />
        </test>
        <!-- vg format -->
        <!-- gfa format (gfa2) -->
    </tests>
    <help><![CDATA[

**What it does**

Converts the HAL output from `Cactus whole-genome multiple sequence
aligner <root?tool_id=cactus_cactus>`__ into other formats.

**Input**

A `HAL
file <https://github.com/ComparativeGenomicsToolkit/cactus#using-the-output>`__
from `Cactus <root?tool_id=cactus_cactus>`__.

**Output**

Note that the MAF file is **reference-based**, so it will contain
alignments to a single reference from your list of inputs (i.e. not a
graph). By default, the first input genome will be used as the
reference. You can override this with the ‘reference genome’ option.

]]></help>

    <expand macro="citations"/>
</tool>